---
title: ç†è§£RESTfulæ²¡æœ‰é‚£ä¹ˆéš¾
categories:
  - æœåŠ¡ç«¯
thumbnail: 'http://img.v5ant.com/images/2019/11/20/2.jpg'
comments: true
toc: true
layout: true
date: 2019-11-21 12:29:16
updated: 2019-11-21 12:29:16
tags:
---

## ä»€ä¹ˆæ˜¯ RESTful ï¼Ÿ

<!-- more -->

rest ä¸æ˜¯é‡ç½®å“ˆï¼Œå®ƒæ ‡è¯†ç¼©å†™`Representational State Transfer`ï¼ˆè¡¨è¿°æ€§çŠ¶æ€è½¬ç§»ï¼‰ï¼Œè¿™å¤ªå­¦æœ¯äº†æˆ‘ä¹Ÿä¸æ‡‚äº†ï¼Œ
ç®€å•æ¥è¯´ `RESTful` ä¸æ˜¯ä¸€ç§æ–°æŠ€æœ¯ï¼Œè€Œæ˜¯ä¸€ç§è§„èŒƒï¼Œå¯¹åº”åº”ç”¨ç¨‹åºäº¤äº’ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¹³æ—¶æ¥è§¦æœ€å¤šçš„æ¥å£ `API` å®šåˆ¶è§„åˆ™ï¼Œä¸ºçš„æ˜¯è®© API ç†è§£æ›´åŠ ç›´è§‚ï¼Œæ˜äº†ï¼Œè§„èŒƒï¼Œå¯ä»¥å®ç°å®¢æˆ·ç«¯æ— éœ€å€ŸåŠ©ä»»ä½•æ–‡æ¡£å³èƒ½è°ƒç”¨åˆ°æ‰€æœ‰çš„æœåŠ¡å™¨èµ„æºã€‚
ä¸€èˆ¬æœåŠ¡ç«¯è®¾è®¡æ¥å£ä¸éµå®ˆè§„èŒƒçš„è¯å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š

```js
api/getGoods?id=xxx GET
api/setUGoods POST
api/updateGoods POST
api/deleteGoods?id=xxx GET/POST
```

è¿™æ ·çš„å…¶å®å…·ä½“ç”¨ä»€ä¹ˆ`getï¼Œpost`éƒ½ä¸€æ ·æ²¡ä»€ä¹ˆåŒºåˆ«çš„,å½“ç„¶æˆ‘ä»¬å…·ä½“æ“ä½œå¿…é¡»æŸ¥çœ‹æ–‡æ¡£ï¼Œä½ ä¹Ÿæ— æ³•æ¨æ–­å‡ºåˆ é™¤å•†å“äººå®¶æ˜¯ `delGoods` è¿˜æ˜¯ `deleteGoods` è¿˜æ˜¯å…¶ä»–,è¿™å®Œå…¨å–å†³äºä½ åç«¯è€å¤§çš„å¿ƒæƒ…ï¼Œè€Œä¸”ä½†å‡¡è¿™ç±»å­˜åœ¨å¢åˆ æ”¹æŸ¥çš„æ¥å£éƒ½èµ·ç  4 ä¸ªæ¥å£ï¼Œè€Œä¸”æ¥å£çš„è¯·æ±‚æ–¹å¼ä¹Ÿæ˜¯æ²¡æœ‰å…·ä½“è¦æ±‚çš„ï¼Œä¹Ÿæ˜¯å¿…é¡»æŒ‰ç…§æ–‡æ¡£å»ä¸€ä¸€æ¯”å¯¹
å¦‚æœæˆ‘ä»¬æŒ‰ç…§ `RESTful` è§„èŒƒå‡ºæ¥å£ä¼šæ˜¯ä»€ä¹ˆæ ·å­çš„å‘¢ï¼Ÿ

```js
api/Goods?id=xxx GET
api/Goods POST
api/Goods PUT
api/Goods?id=xxx DELETE
```

çœ‹åˆ°è¿™é‡Œåº”è¯¥å¾ˆæ˜ç™½äº†å§ï¼Œè§„èŒƒå®Œå…¨æŒ‰ç…§ HTTP è¯·æ±‚è§„èŒƒç±»å‹ä¸€ä¸€å¯¹åº”ï¼Œè€Œä¸”åªæœ‰ä¸€ä¸ªæ¥å£ï¼Œé‚£å°±æ˜¯å•†å“æ¥å£ï¼Œæ‹¿åˆ°å•†å“æ¥å£ç†è®ºä¸Šæˆ‘å¯ä»¥ç›´æ¥è¿›è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œï¼Œæ˜¯ä¸æ˜¯å¾ˆç›´è§‚ï¼Œå¾ˆæ–¹ä¾¿ï¼Ÿ

> ä»¥ä¸Šå®Œå…¨æ˜¯ä¸ªäººç†è§£ï¼Œåˆ‡ä¸å¯å½“åšä½œä¸ºæ­£ç»è§£é‡Š ğŸ˜

## RESTful æ˜¯æœ€ä½³å®è·µ

### URL æ¥å£è®¾è®¡

`RESTful` çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯ï¼Œå®¢æˆ·ç«¯å‘å‡ºçš„æ•°æ®æ“ä½œæŒ‡ä»¤éƒ½æ˜¯"åŠ¨è¯ + å®¾è¯­"çš„ç»“æ„,æ¯”å¦‚ `GET /Goods`,è¿™ä¸ªå‘½ä»¤ï¼Œ`GET` æ˜¯åŠ¨è¯ï¼Œ`/articles` æ˜¯å®¾è¯­ã€‚

- GETï¼šè·å–ï¼ˆGetï¼‰
- POSTï¼šæ–°å»ºï¼ˆCreateï¼‰
- PUTï¼šæ›´æ–°ï¼ˆUpdateï¼‰
- PATCHï¼šæ›´æ–°ï¼ˆUpdateï¼‰ï¼Œé€šå¸¸æ˜¯éƒ¨åˆ†æ›´æ–°
- DELETEï¼šåˆ é™¤ï¼ˆDeleteï¼‰

æ ¹æ® `HTTP` è§„èŒƒï¼ŒåŠ¨è¯ä¸€å¾‹å¤§å†™ã€‚

æœ‰äº›å®¢æˆ·ç«¯åªèƒ½ä½¿ç”¨ `GET` å’Œ `POST` è¿™ä¸¤ç§æ–¹æ³•ã€‚æœåŠ¡å™¨å¿…é¡»æ¥å— `POST` æ¨¡æ‹Ÿå…¶ä»–ä¸‰ä¸ªæ–¹æ³•`ï¼ˆPUTã€PATCHã€DELETEï¼‰`ã€‚

è¿™æ—¶ï¼Œå®¢æˆ·ç«¯å‘å‡ºçš„ `HTTP` è¯·æ±‚ï¼Œè¦åŠ ä¸Š `X-HTTP-Method-Override` å±æ€§ï¼Œå‘Šè¯‰æœåŠ¡å™¨åº”è¯¥ä½¿ç”¨å“ªä¸€ä¸ªåŠ¨è¯ï¼Œè¦†ç›– POST æ–¹æ³•ã€‚

```js
POST /api/Goods/1 HTTP/1.1
X-HTTP-Method-Override: PUT
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`X-HTTP-Method-Override` æŒ‡å®šæœ¬æ¬¡è¯·æ±‚çš„æ–¹æ³•æ˜¯ `PUT`ï¼Œè€Œä¸æ˜¯ `POST`ã€‚
å®¾è¯­æ˜¯ `API` ä¸­çš„ `URL` éƒ¨åˆ† ä¸Šé¢ä¹‹å‰é‚£ç§ `api/getGoods`å°±æ˜¾ç„¶ä¸åˆç†,é‡Œé¢ä¸è¦åŒ…å«åŠ¨è¯`get,put,post`ä¹‹ç±»ï¼Œå› ä¸ºæœ¬èº«è¯·æ±‚ç±»å‹å·²ç»æ˜ç¡®äº†éœ€è¦ä»€ä¹ˆæ“ä½œçš„
è€Œä¸”ï¼Œè¿™é‡Œå®¾è¯­å°½é‡ä½¿ç”¨å¤æ•°ï¼Œæ¯•ç«Ÿä½ æ“ä½œçš„æ˜¯ä¸€ä¸ªé›†åˆå˜›

é¿å…å¤šçº§ `URL`
å¸¸è§çš„æƒ…å†µæ˜¯ï¼Œèµ„æºéœ€è¦å¤šçº§åˆ†ç±»ï¼Œå› æ­¤å¾ˆå®¹æ˜“å†™å‡ºå¤šçº§çš„ URLï¼Œæ¯”å¦‚è·å–æŸä¸ªä½œè€…çš„æŸä¸€ç±»æ–‡ç« ã€‚

`GET /authors/12/categories/2`
è¿™ç§ `URL` ä¸åˆ©äºæ‰©å±•ï¼Œè¯­ä¹‰ä¹Ÿä¸æ˜ç¡®ï¼Œå¾€å¾€è¦æƒ³ä¸€ä¼šï¼Œæ‰èƒ½æ˜ç™½å«ä¹‰ã€‚

æ›´å¥½çš„åšæ³•æ˜¯ï¼Œé™¤äº†ç¬¬ä¸€çº§ï¼Œå…¶ä»–çº§åˆ«éƒ½ç”¨æŸ¥è¯¢å­—ç¬¦ä¸²è¡¨è¾¾ã€‚

`GET /authors/12?categories=2`
ä¸‹é¢æ˜¯å¦ä¸€ä¸ªä¾‹å­ï¼ŒæŸ¥è¯¢å·²å‘å¸ƒçš„æ–‡ç« ã€‚ä½ å¯èƒ½ä¼šè®¾è®¡æˆä¸‹é¢çš„ URLã€‚

`GET /articles/published`
æŸ¥è¯¢å­—ç¬¦ä¸²çš„å†™æ³•æ˜æ˜¾æ›´å¥½ã€‚

`GET /articles?published=true`

### çŠ¶æ€ç  è®¾è®¡

1. `200` çŠ¶æ€ç è¡¨ç¤ºæ“ä½œæˆåŠŸï¼Œä½†æ˜¯ä¸åŒçš„æ–¹æ³•å¯ä»¥è¿”å›æ›´ç²¾ç¡®çš„çŠ¶æ€ç ã€‚

```
GET: 200 OK
POST: 201 Created
PUT: 200 OK
PATCH: 200 OK
DELETE: 204 No Content
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`POST` è¿”å› `201` çŠ¶æ€ç ï¼Œè¡¨ç¤ºç”Ÿæˆäº†æ–°çš„èµ„æºï¼›`DELETE`è¿”å› `204` çŠ¶æ€ç ï¼Œè¡¨ç¤ºèµ„æºå·²ç»ä¸å­˜åœ¨ã€‚

æ­¤å¤–ï¼Œ`202 Accepted`çŠ¶æ€ç è¡¨ç¤ºæœåŠ¡å™¨å·²ç»æ”¶åˆ°è¯·æ±‚ï¼Œä½†è¿˜æœªè¿›è¡Œå¤„ç†ï¼Œä¼šåœ¨æœªæ¥å†å¤„ç†ï¼Œé€šå¸¸ç”¨äºå¼‚æ­¥æ“ä½œã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚

```js
// HTTP/1.1 202 Accepted
{
"task": {
"href": "/api/company/job-management/jobs/xxx",
"id": "xxx"
}
}
```

2. `3xx` çŠ¶æ€ç 
   API ç”¨ä¸åˆ° `301` çŠ¶æ€ç ï¼ˆæ°¸ä¹…é‡å®šå‘ï¼‰å’Œ `302` çŠ¶æ€ç ï¼ˆæš‚æ—¶é‡å®šå‘ï¼Œ307 ä¹Ÿæ˜¯è¿™ä¸ªå«ä¹‰ï¼‰ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥ç”±åº”ç”¨çº§åˆ«è¿”å›ï¼Œæµè§ˆå™¨ä¼šç›´æ¥è·³è½¬ï¼ŒAPI çº§åˆ«å¯ä»¥ä¸è€ƒè™‘è¿™ä¸¤ç§æƒ…å†µã€‚

API ç”¨åˆ°çš„ `3xx` çŠ¶æ€ç ï¼Œä¸»è¦æ˜¯ `303 See Other`ï¼Œè¡¨ç¤ºå‚è€ƒå¦ä¸€ä¸ª `URL`ã€‚å®ƒä¸ `302` å’Œ `307` çš„å«ä¹‰ä¸€æ ·ï¼Œä¹Ÿæ˜¯"æš‚æ—¶é‡å®šå‘"ï¼ŒåŒºåˆ«åœ¨äº `302` å’Œ `307` ç”¨äº `GET` è¯·æ±‚ï¼Œè€Œ `303` ç”¨äº `POSTã€PUT` å’Œ `DELETE` è¯·æ±‚ã€‚æ”¶åˆ° `303` ä»¥åï¼Œæµè§ˆå™¨ä¸ä¼šè‡ªåŠ¨è·³è½¬ï¼Œè€Œä¼šè®©ç”¨æˆ·è‡ªå·±å†³å®šä¸‹ä¸€æ­¥æ€ä¹ˆåŠã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚

```js
HTTP/1.1 303 See Other
Location: /api/orders/12345
```

3. `4xx` çŠ¶æ€ç 
   `4xx` çŠ¶æ€ç è¡¨ç¤ºå®¢æˆ·ç«¯é”™è¯¯ï¼Œä¸»è¦æœ‰ä¸‹é¢å‡ ç§ã€‚

```js
// 400 Bad Requestï¼šæœåŠ¡å™¨ä¸ç†è§£å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œæœªåšä»»ä½•å¤„ç†ã€‚

// 401 Unauthorizedï¼šç”¨æˆ·æœªæä¾›èº«ä»½éªŒè¯å‡­æ®ï¼Œæˆ–è€…æ²¡æœ‰é€šè¿‡èº«ä»½éªŒè¯ã€‚

// 403 Forbiddenï¼šç”¨æˆ·é€šè¿‡äº†èº«ä»½éªŒè¯ï¼Œä½†æ˜¯ä¸å…·æœ‰è®¿é—®èµ„æºæ‰€éœ€çš„æƒé™ã€‚

// 404 Not Foundï¼šæ‰€è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨ï¼Œæˆ–ä¸å¯ç”¨ã€‚

// 405 Method Not Allowedï¼šç”¨æˆ·å·²ç»é€šè¿‡èº«ä»½éªŒè¯ï¼Œä½†æ˜¯æ‰€ç”¨çš„ HTTP æ–¹æ³•ä¸åœ¨ä»–çš„æƒé™ä¹‹å†…ã€‚

// 410 Goneï¼šæ‰€è¯·æ±‚çš„èµ„æºå·²ä»è¿™ä¸ªåœ°å€è½¬ç§»ï¼Œä¸å†å¯ç”¨ã€‚

// 415 Unsupported Media Typeï¼šå®¢æˆ·ç«¯è¦æ±‚çš„è¿”å›æ ¼å¼ä¸æ”¯æŒã€‚æ¯”å¦‚ï¼ŒAPI åªèƒ½è¿”å› JSON æ ¼å¼ï¼Œä½†æ˜¯å®¢æˆ·ç«¯è¦æ±‚è¿”å› XML æ ¼å¼ã€‚

// 422 Unprocessable Entity ï¼šå®¢æˆ·ç«¯ä¸Šä¼ çš„é™„ä»¶æ— æ³•å¤„ç†ï¼Œå¯¼è‡´è¯·æ±‚å¤±è´¥ã€‚

// 429 Too Many Requestsï¼šå®¢æˆ·ç«¯çš„è¯·æ±‚æ¬¡æ•°è¶…è¿‡é™é¢ã€‚
```

4. `5xx` çŠ¶æ€ç 
   `5xx` çŠ¶æ€ç è¡¨ç¤ºæœåŠ¡ç«¯é”™è¯¯ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œ`API` ä¸ä¼šå‘ç”¨æˆ·é€éœ²æœåŠ¡å™¨çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ‰€ä»¥åªè¦ä¸¤ä¸ªçŠ¶æ€ç å°±å¤Ÿäº†ã€‚

```js
// 500 Internal Server Errorï¼šå®¢æˆ·ç«¯è¯·æ±‚æœ‰æ•ˆï¼ŒæœåŠ¡å™¨å¤„ç†æ—¶å‘ç”Ÿäº†æ„å¤–ã€‚

// 503 Service Unavailableï¼šæœåŠ¡å™¨æ— æ³•å¤„ç†è¯·æ±‚ï¼Œä¸€èˆ¬ç”¨äºç½‘ç«™ç»´æŠ¤çŠ¶æ€ã€‚
```

### æœåŠ¡ç«¯å“åº”çš„ä¸€äº›æ³¨æ„

1. ä¸è¦è¿”å›çº¯æœ¬æ–‡
   `API` è¿”å›çš„æ•°æ®æ ¼å¼ï¼Œä¸åº”è¯¥æ˜¯çº¯æ–‡æœ¬ï¼Œè€Œåº”è¯¥æ˜¯ä¸€ä¸ª `JSON` å¯¹è±¡ï¼Œå› ä¸ºè¿™æ ·æ‰èƒ½è¿”å›æ ‡å‡†çš„ç»“æ„åŒ–æ•°æ®ã€‚æ‰€ä»¥ï¼ŒæœåŠ¡å™¨å›åº”çš„ `HTTP` å¤´çš„ `Content-Type` å±æ€§è¦è®¾ä¸º `application/json`ã€‚å®¢æˆ·ç«¯è¯·æ±‚æ—¶ï¼Œä¹Ÿè¦æ˜ç¡®å‘Šè¯‰æœåŠ¡å™¨ï¼Œå¯ä»¥æ¥å— `JSON` æ ¼å¼ï¼Œå³è¯·æ±‚çš„ `HTTP` å¤´çš„ `ACCEPT` å±æ€§ä¹Ÿè¦è®¾æˆ `application/json`ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚

```js
GET /orders/2 HTTP/1.1
Accept: application/json
```

2. å‘ç”Ÿé”™è¯¯æ—¶ï¼Œä¸è¦è¿”å› `200` çŠ¶æ€ç 
   æœ‰ä¸€ç§ä¸æ°å½“çš„åšæ³•æ˜¯ï¼Œå³ä½¿å‘ç”Ÿé”™è¯¯ï¼Œä¹Ÿè¿”å› `200` çŠ¶æ€ç ï¼ŒæŠŠé”™è¯¯ä¿¡æ¯æ”¾åœ¨æ•°æ®ä½“é‡Œé¢ï¼Œå°±åƒä¸‹é¢è¿™æ ·ã€‚

```js
// HTTP/1.1 200 OK
// Content-Type: application/json
{
"status": "failure",
"data": {
"error": "Expected at least two items in list."
}
}
```

ä¸Šé¢ä»£ç ä¸­ï¼Œè§£ææ•°æ®ä½“ä»¥åï¼Œæ‰èƒ½å¾—çŸ¥æ“ä½œå¤±è´¥ã€‚

è¿™å¼ åšæ³•å®é™…ä¸Šå–æ¶ˆäº†çŠ¶æ€ç ï¼Œè¿™æ˜¯å®Œå…¨ä¸å¯å–çš„ã€‚æ­£ç¡®çš„åšæ³•æ˜¯ï¼ŒçŠ¶æ€ç åæ˜ å‘ç”Ÿçš„é”™è¯¯ï¼Œå…·ä½“çš„é”™è¯¯ä¿¡æ¯æ”¾åœ¨æ•°æ®ä½“é‡Œé¢è¿”å›ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚

```js
// HTTP/1.1 400 Bad Request
// Content-Type: application/json

{
"error": "Invalid payoad.",
"detail": {
"surname": "This field is required."
}
}
```

3. æä¾›é“¾æ¥
   `API` çš„ä½¿ç”¨è€…æœªå¿…çŸ¥é“ï¼Œ`URL` æ˜¯æ€ä¹ˆè®¾è®¡çš„ã€‚ä¸€ä¸ªè§£å†³æ–¹æ³•å°±æ˜¯ï¼Œåœ¨å›åº”ä¸­ï¼Œç»™å‡ºç›¸å…³é“¾æ¥ï¼Œä¾¿äºä¸‹ä¸€æ­¥æ“ä½œã€‚è¿™æ ·çš„è¯ï¼Œç”¨æˆ·åªè¦è®°ä½ä¸€ä¸ª`URL`ï¼Œå°±å¯ä»¥å‘ç°å…¶ä»–çš„ `URL`ã€‚è¿™ç§æ–¹æ³•å«åš `HATEOAS`ã€‚

ä¸¾ä¾‹æ¥è¯´ï¼Œ`GitHub` çš„ `API` éƒ½åœ¨ `api.github.com` è¿™ä¸ªåŸŸåã€‚è®¿é—®å®ƒï¼Œå°±å¯ä»¥å¾—åˆ°å…¶ä»– `URL`ã€‚

```js
{
...
"feeds_url": "https://api.github.com/feeds",
"followers_url": "https://api.github.com/user/followers",
"following_url": "https://api.github.com/user/following{/target}",
"gists_url": "https://api.github.com/gists{/gist_id}",
"hub_url": "https://api.github.com/hub",
...
}
```

ä¸Šé¢çš„å›åº”ä¸­ï¼ŒæŒ‘ä¸€ä¸ª `URL` è®¿é—®ï¼Œåˆå¯ä»¥å¾—åˆ°åˆ«çš„ `URL`ã€‚å¯¹äºç”¨æˆ·æ¥è¯´ï¼Œä¸éœ€è¦è®°ä½`URL` è®¾è®¡ï¼Œåªè¦ä» `api.github.com` ä¸€æ­¥æ­¥æŸ¥æ‰¾å°±å¯ä»¥äº†ã€‚

`HATEOAS` çš„æ ¼å¼æ²¡æœ‰ç»Ÿä¸€è§„å®šï¼Œä¸Šé¢ä¾‹å­ä¸­ï¼Œ`GitHub` å°†å®ƒä»¬ä¸å…¶ä»–å±æ€§æ”¾åœ¨ä¸€èµ·ã€‚æ›´å¥½çš„åšæ³•åº”è¯¥æ˜¯ï¼Œå°†ç›¸å…³é“¾æ¥ä¸å…¶ä»–å±æ€§åˆ†å¼€ã€‚

```js
// HTTP/1.1 200 OK
// Content-Type: application/json

{
"status": "In progress",
"links": {[
{ "rel":"cancel", "method": "delete", "href":"/api/status/12345" } ,
{ "rel":"edit", "method": "put", "href":"/api/status/12345" }
]}
}
```

å¬è¯´å¥½çš„è§„èŒƒå¯ä»¥æå‡ç¼–ç çš„å¹¸ç¦æ„Ÿï¼Œæ˜¯å—ï¼Ÿ

> å‚è€ƒæ–‡ç« ï¼š é˜®ä¸€å³°è€å¸ˆæ–‡ç« => http://www.ruanyifeng.com/blog/2018/10/restful-api-best-practices.html
