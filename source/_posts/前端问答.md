---
title: å‰ç«¯å¤§å‚é¢è¯•é—®ç­”[1]
comments: true
toc: true
date: 2019-09-11 19:50:58
tags:
categories:
- å¤§å‰ç«¯
- é¢è¯•é¢˜ç±»
thumbnail:
---

> å£°æ˜ï¼šå…³äºä»¥ä¸‹é¢è¯•é¢˜æ”¶é›†æ¥æº ï¼ˆå£¹é¢˜ï¼‰https://github.com/Advanced-Frontend/Daily-Interview-Question/blob/master/datum/summary.md ç­”æ¡ˆç»¼åˆäº†è‡ªå·±ç†è§£å¦‚æœ‰è¯¯åŒºè¯·å¸®å¿™æŒ‡å‡ºï¼Œè°¢è°¢ ğŸ˜†

## ç¬¬ 1 é¢˜ï¼šï¼ˆæ»´æ»´ã€é¥¿äº†ä¹ˆï¼‰å†™ React / Vue é¡¹ç›®æ—¶ä¸ºä»€ä¹ˆè¦åœ¨åˆ—è¡¨ç»„ä»¶ä¸­å†™ keyï¼Œå…¶ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ

<!-- more -->

é¦–å…ˆå¯ä»¥çŸ¥é“`React`/`Vue`éƒ½æ˜¯åŸºäº Vnodeï¼ˆè™šæ‹ŸèŠ‚ç‚¹ï¼‰é‡‡ç”¨ `diff` ç®—æ³•è¿›è¡Œæ›´æ–°ï¼Œé€šè¿‡ key å€¼ç»‘å®šå¯ä»¥æ›´å¿«é€Ÿï¼Œæ›´å‡†ç¡®æ‹¿åˆ° oldVnode ä¸­å¯¹åº”çš„ vnode èŠ‚ç‚¹ï¼Œæé«˜ diff æ•ˆç‡ã€‚

vue éƒ¨åˆ†æºç è§£æ

```js
// vue é¡¹ç›® src/core/vdom/patch.js -488 è¡Œ
// ä»¥ä¸‹æ˜¯ä¸ºäº†é˜…è¯»æ€§è¿›è¡Œæ ¼å¼åŒ–åçš„ä»£ç 

// oldCh æ˜¯ä¸€ä¸ªæ—§è™šæ‹ŸèŠ‚ç‚¹æ•°ç»„
if (isUndef(oldKeyToIdx)) {
  oldKeyToIdx = createKeyToOldIdx(oldCh, oldStartIdx, oldEndIdx);
}
if (isDef(newStartVnode.key)) {
  // map æ–¹å¼è·å–
  idxInOld = oldKeyToIdx[newStartVnode.key];
} else {
  // éå†æ–¹å¼è·å–
  idxInOld = findIdxInOld(newStartVnode, oldCh, oldStartIdx, oldEndIdx);
}
```

åˆ›å»º map å‡½æ•°

```js
function createKeyToOldIdx(children, beginIdx, endIdx) {
  let i, key;
  const map = {};
  for (i = beginIdx; i <= endIdx; ++i) {
    key = children[i].key;
    if (isDef(key)) map[key] = i;
  }
  return map;
}
```

éå†å¯»æ‰¾

```js
// sameVnode æ˜¯å¯¹æ¯”æ–°æ—§èŠ‚ç‚¹æ˜¯å¦ç›¸åŒçš„å‡½æ•°
function findIdxInOld(node, oldCh, start, end) {
  for (let i = start; i < end; i++) {
    const c = oldCh[i];

    if (isDef(c) && sameVnode(node, c)) return i;
  }
}
```

ç›¸å¯¹éå†æŸ¥æ‰¾ `map` æ˜ å°„ç†è®ºä¸Šæ›´å¿«é€Ÿå°¤å…¶åœ¨å¯¹æ¯”è¾ƒå¤§çš„æ•°æ®é‡çš„æ—¶å€™æ•ˆæœå°±å¾ˆæ˜æ˜¾äº†ï¼Œè¿˜æœ‰ä¸€ä¸ªå°±æ˜¯æ•°æ®æ›´æ–°æ—¶ç»„ä»¶çš„å¼ºåˆ¶æ›´æ–°ï¼Œ
ä»¥é¿å…â€œåŸåœ°å¤ç”¨â€å¸¦æ¥çš„å‰¯ä½œç”¨ã€‚

æ€»ç»“ä¸€å¥å°±æ˜¯ï¼Œ`key` æ˜¯å¯ä»¥æ›´å‡†ç¡®çš„ï¼Œæ›´å¿«é€Ÿçš„æ›´æ–°èŠ‚ç‚¹ï¼Œè€Œä¸”ä¸å»ºè®®ä½¿ç”¨`index`åš `key`ï¼Œå› ä¸ºæ¯æ¬¡ç´¢å¼•éƒ½ä¸€æ ·å¯¼è‡´æ›´æ–°æ—¶å€™ä¸ä¼šæœ‰ä»»ä½•æ•ˆæœ

## ç¬¬ 2 é¢˜ï¼š['1', '2', '3'].map(parseInt) what & why ?

åˆšçœ‹åˆ°è¿™ä¸ªé¢˜ç›®å¤§éƒ¨åˆ†äººè·Ÿæˆ‘ä¸€æ ·éƒ½ä¼šä¸‹æ„è¯†çš„è®¤ä¸ºè¿”å›å€¼åº”è¯¥æ˜¯`[1,2,3]`ï¼Œå¥½åƒå“ªé‡Œä¸å¯¹å“ˆï¼Œæˆ‘ä»¬ä¸€èµ·ä¸€æ­¥ä¸€æ­¥åˆ†ææ¥çœ‹
è¿™ä¸ªé¢˜ä¸»è¦è€ƒå¯Ÿçš„æ˜¯ `map` å’Œ `parseInt` ä¼ å‚

### map

`map()` æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„ï¼Œå…¶ç»“æœæ˜¯è¯¥æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½è°ƒç”¨ä¸€ä¸ªæä¾›çš„å‡½æ•°åè¿”å›çš„ç»“æœã€‚

```js
var new_array = arr.map(function callback(currentValue[,index[, array]]) {
 // Return element for new_array
 }[, thisArg])
//  currentValue :å½“å‰å€¼
//  index : ç´¢å¼•å€¼
//  array : callback map æ–¹æ³•è¢«è°ƒç”¨çš„æ•°ç»„
```

[MDN](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/map)

### parseInt

parseInt() å‡½æ•°è§£æä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæŒ‡å®šåŸºæ•°çš„æ•´æ•° (æ•°å­¦ç³»ç»Ÿçš„åŸºç¡€)ã€‚

```js
const intValue = parseInt(string[, radix]);
// string : è¦è¢«è§£æçš„å€¼ã€‚å¦‚æœå‚æ•°ä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåˆ™å°†å…¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²(ä½¿ç”¨ ToString æŠ½è±¡æ“ä½œ)ã€‚å­—ç¬¦ä¸²å¼€å¤´çš„ç©ºç™½ç¬¦å°†ä¼šè¢«å¿½ç•¥ã€‚
// radix : ä¸€ä¸ªä»‹äº2å’Œ36ä¹‹é—´çš„æ•´æ•°(æ•°å­¦ç³»ç»Ÿçš„åŸºç¡€)ï¼Œè¡¨ç¤ºä¸Šè¿°å­—ç¬¦ä¸²çš„åŸºæ•°ã€‚é»˜è®¤ä¸º10ã€‚å¦‚æœè¯¥å‚æ•°å°äº 2 æˆ–è€…å¤§äº 36ï¼Œåˆ™ parseInt() å°†è¿”å› NaNã€‚
// è¿”å›å€¼ : è¿”å›ä¸€ä¸ªæ•´æ•°æˆ–NaN
```

[MDN](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/parseInt)
æ¸©ä¹ äº†åŸºç¡€çŸ¥è¯†åç®€å•åˆ†æä¸€ä¸‹ï¼Œé¦–å…ˆ `map` å‡½æ•°ä¼ äº† `parseInt` ä½œä¸ºå›è°ƒå‡½æ•°ï¼Œé‚£ä¹ˆ `map` çš„ç›¸å…³å‚æ•°ä¹Ÿå°±ç›´æ¥å¯ä»¥ä¼ å…¥ `parseInt` å‡½æ•°ä¸­ï¼Œmap çš„ currentValue ä½œä¸º`parseInt` è¦è¢«è§£æçš„å­—ç¬¦ä¸²ä¼ å…¥ï¼Œç¬¬äºŒä¸ªå½“å‰å€¼çš„ç´¢å¼•è¢«å½“åš`radix` è¿›åˆ¶æ•°ä¼ å…¥ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°å¿½ç•¥ã€‚
map éå†å¤§æ¦‚æ‰§è¡Œäº†ä¸‹é¢ 3 ä¸ªé€»è¾‘

```js
parseInt('1', 0);
parseInt('2', 1);
parseInt('3', 2);
```

æ³¨æ„ï¼š
åœ¨ radix ä¸º undefinedï¼Œæˆ–è€… radix ä¸º 0 æˆ–è€…æ²¡æœ‰æŒ‡å®šçš„æƒ…å†µä¸‹ï¼ŒJavaScript ä½œå¦‚ä¸‹å¤„ç†ï¼š

- å¦‚æœå­—ç¬¦ä¸² string ä»¥"0x"æˆ–è€…"0X"å¼€å¤´, åˆ™åŸºæ•°æ˜¯ 16 (16 è¿›åˆ¶).
- å¦‚æœå­—ç¬¦ä¸² string ä»¥"0"å¼€å¤´, åŸºæ•°æ˜¯ 8ï¼ˆå…«è¿›åˆ¶ï¼‰æˆ–è€… 10ï¼ˆåè¿›åˆ¶ï¼‰ï¼Œé‚£ä¹ˆå…·ä½“æ˜¯å“ªä¸ªåŸºæ•°ç”±å®ç°ç¯å¢ƒå†³å®šã€‚ECMAScript 5 è§„å®šä½¿ç”¨ 10ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰çš„æµè§ˆå™¨éƒ½éµå¾ªè¿™ä¸ªè§„å®šã€‚å› æ­¤ï¼Œæ°¸è¿œéƒ½è¦æ˜ç¡®ç»™å‡º radix å‚æ•°çš„å€¼ã€‚
- å¦‚æœå­—ç¬¦ä¸² string ä»¥å…¶å®ƒä»»ä½•å€¼å¼€å¤´ï¼Œåˆ™åŸºæ•°æ˜¯ 10 (åè¿›åˆ¶)ã€‚`

ç»“è®º
ç¬¬ä¸€ä¸ªä¼ å…¥åŸºæ•°ä¸º 0 å¹¶ä¸”å­—ç¬¦ä¸²æ²¡æœ‰ä»¥ `0` æˆ–è€… `0x` å¼€å¤´ï¼Œé»˜è®¤å– `10` è¿›åˆ¶ï¼Œé‚£ä¹ˆè¿”å›å€¼å°±æ˜¯`Number` 1
ç¬¬äºŒä¸ªä¼ å…¥åŸºæ•°ä¸º 1 æ— æ•ˆï¼Œç›´æ¥è¿”å› `NaN`
ç¬¬ä¸‰ä¸ªä¼ å…¥åŸºæ•°ä¸º 2ï¼Œé‚£ä¹ˆå°±æ˜¯ä»¥ 2 è¿›åˆ¶è¿ç®—è§£æï¼Œä½†æ˜¯äºŒè¿›åˆ¶ä¸­åªèƒ½ä¸º`1` or `0`,ä¼ å…¥ `3` ä¸ºéæ³•å€¼ï¼Œè¿”å› `NaN`
è¿”å›ç»“æœ `[1,NaN,NaN]`
å¦‚ä½•æŒ‰ç…§æˆ‘ä»¬é¢„æœŸè¿”å›å¯¹åº”`Number`ç±»å‹ï¼Ÿ

```js
['1', '2', '3'].map(num => parseInt(num, 10));
```

## ç¬¬ 3 é¢˜ï¼šï¼ˆæŒ–è´¢ï¼‰ä»€ä¹ˆæ˜¯é˜²æŠ–å’ŒèŠ‚æµï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå¦‚ä½•å®ç°ï¼Ÿ

### é˜²æŠ–

è§¦å‘é«˜é¢‘äº‹ä»¶å n ç§’å†…å‡½æ•°åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œå¦‚æœ n ç§’å†…é«˜é¢‘äº‹ä»¶å†æ¬¡è¢«è§¦å‘ï¼Œåˆ™é‡æ–°è®¡ç®—æ—¶é—´,ç®€å•æ¥è¯´å°±æ˜¯é¿å…äº‹ä»¶é¢‘ç¹è¢«è°ƒç”¨

æ€è·¯
æ¯æ¬¡è§¦å‘é«˜é¢‘æ“ä½œåå–æ¶ˆä¹‹å‰çš„å»¶æ—¶è°ƒç”¨

```js
function debounce(fn) {
  let timer = null;
  return function() {
    clearTimeout(timer);
    timer = setTimeout(() => {
      fn.apply(this, arguments);
    }, 500);
  };
}
function doSomething() {
  console.log('é˜²æŠ–æˆåŠŸäº†ï¼');
}
const inp = document.querySelector('#inp');
inp.addEventListener('input', debounce(doSomething)); // é˜²æŠ–
```

### èŠ‚æµ

æŒ‡å®šæ—¶é—´æ®µå†…åªå…è®¸ç¨‹åºè°ƒç”¨ä¸€æ¬¡

æ€è·¯
æ¯æ¬¡è°ƒç”¨ä¹‹å‰åˆ¤æ–­æ˜¯å¦è¶…æ—¶ï¼Œå¦‚æœªè¶…æ—¶æ‹’ç»æ‰§è¡Œç­‰å¾…ä¸‹æ¬¡è°ƒç”¨

```js
function throttle(fu, time = 500) {
  let timer = null;
  return function() {
    if (timer) return;
    setTimeout(() => {
      fn.apply(this, arguments);
      clearTimeout(timer);
      timer = null;
    }, time);
  };
}
```
